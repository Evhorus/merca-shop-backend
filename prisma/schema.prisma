// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Product model: represents items in the catalog
model Product {
  id                String             @id @default(uuid())
  name              String             @unique
  slug              String             @unique
  origin            String
  sku               String             @unique
  price             Decimal            @db.Decimal(10, 2)
  brand             String
  stock             Int                @default(0)
  isActive          Boolean
  categoryId        String
  description       String?
  category          Category           @relation(fields: [categoryId], references: [id])
  images            ProductImage[]
  productVariants   ProductVariant[]
  productFeatures   ProductFeature[]
  productDimensions ProductDimensions?
  color             Color?             @relation(fields: [colorId], references: [id])
  colorId           String?

  @@index([categoryId, sku, brand])
}

// Product features: key-value attributes like material, warranty, etc.
model ProductFeature {
  id        String  @id @default(uuid())
  name      String
  value     String
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// Product images: stores image URLs or paths for each product
model ProductImage {
  id        String  @id @default(uuid())
  image     String
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// Product dimensions: length, width, height for shipping and display
model ProductDimensions {
  id        String  @id @default(uuid())
  length    Decimal @db.Decimal(10, 2)
  width     Decimal @db.Decimal(10, 2)
  height    Decimal @db.Decimal(10, 2)
  unit      Unit
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// Product variants: different SKUs for colors, sizes, etc.
model ProductVariant {
  id                       String                   @id @default(uuid())
  sku                      String                   @unique
  availableQuantity        Int
  price                    Decimal                  @db.Decimal(10, 2)
  color                    String
  productId                String
  product                  Product                  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productVariantDimensions ProductVariantDimension?
}

// Product variant dimensions: specific measurements for each variant
model ProductVariantDimension {
  id               String         @id @default(uuid())
  length           Decimal        @db.Decimal(10, 2)
  width            Decimal        @db.Decimal(10, 2)
  height           Decimal        @db.Decimal(10, 2)
  depth            Decimal?       @db.Decimal(10, 2)
  diameter         Decimal?       @db.Decimal(10, 2)
  unit             Unit
  productVariantId String         @unique
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id], onDelete: Cascade)
}

// Unit enum: measurement units for dimensions
enum Unit {
  cm
  in
  mm
  m
}

// Category model: hierarchical product organization with self-reference
model Category {
  id          String          @id @default(uuid())
  name        String          @unique
  slug        String          @unique
  description String?
  images      CategoryImage[]
  products    Product[]
  isActive    Boolean
  parentId    String?         @map("parent_id")
  parent      Category?       @relation("CategoryToParent", fields: [parentId], references: [id])
  children    Category[]      @relation("CategoryToParent")

  @@index([name, slug])
}

// Category images: multiple images per category, unique per category
model CategoryImage {
  id         String   @id @default(uuid())
  image      String
  categoryId String
  Category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, image]) // Each image is unique per category
  @@index([categoryId])
}

// Color model: standard color codes and names for products
model Color {
  id        String    @id @default(uuid())
  colorCode String    @unique
  colorName String
  products  Product[]

  @@unique([colorCode, colorName])
}
